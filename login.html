<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SESSÃO 99</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<style>
:root{
  --bg:#000;
  --panel:#0b0b0b;
  --text:#fff;
  --muted:#aaa;
  --accent:#e50914;
}
*{box-sizing:border-box;scrollbar-width:none}
*::-webkit-scrollbar{display:none}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Arial,sans-serif;
  overflow:hidden;
}

/* HEADER (IDÊNTICO) */
header{
  position:fixed;
  top:0;left:0;right:0;
  height:70px;
  display:flex;
  align-items:center;
  gap:16px;
  padding:0 24px;
  background:rgba(0,0,0,.85);
  backdrop-filter:blur(10px);
  z-index:50;
}
.logo{color:var(--accent);font-size:22px;font-weight:800}

/* LOGIN CONTAINER */
#login{
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.box{
  width:420px;
  background:var(--panel);
  border-radius:18px;
  padding:32px;
  box-shadow:0 40px 80px rgba(0,0,0,.8);
}

.box h1{
  margin:0 0 8px;
  font-size:24px;
  color:var(--accent);
}
.box p{
  margin:0 0 20px;
  color:var(--muted);
  font-size:14px;
}

/* INPUTS */
.box input{
  width:100%;
  height:44px;
  margin-bottom:12px;
  border-radius:22px;
  border:1px solid #333;
  background:#111;
  color:#fff;
  padding:0 18px;
  outline:none;
}
.box input::placeholder{color:var(--muted)}

/* BUTTON */
.box button{
  width:100%;
  height:46px;
  border-radius:24px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-weight:700;
  cursor:pointer;
  margin-top:6px;
}

/* MSG */
.msg{
  margin-top:12px;
  min-height:18px;
  font-size:14px;
  color:#ff9f9f;
}
</style>
</head>

<body>

<header>
  <div class="logo">SESSÃO 99</div>
</header>

<div id="login">
  <div class="box">
    <h1>Entrar</h1>
    <p>Use seu email para acessar ou criar sua conta</p>

    <input id="email" placeholder="Email">
    <input id="senha" type="password" placeholder="Senha">
    <input id="cpf" placeholder="CPF">
    <input id="celular" placeholder="Celular">

    <button onclick="entrar()">Entrar</button>
    <div class="msg" id="msg"></div>
  </div>
</div>

<script>
const sb = supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

const msg=document.getElementById("msg");

/* ===== MASKS ===== */
cpf.oninput=e=>{
  let v=e.target.value.replace(/\D/g,"").slice(0,11);
  v=v.replace(/(\d{3})(\d)/,"$1.$2");
  v=v.replace(/(\d{3})(\d)/,"$1.$2");
  v=v.replace(/(\d{3})(\d{1,2})$/,"$1-$2");
  e.target.value=v;
};
celular.oninput=e=>{
  let v=e.target.value.replace(/\D/g,"").slice(0,11);
  v=v.replace(/(\d{2})(\d)/,"($1) $2");
  v=v.replace(/(\d{5})(\d)/,"$1-$2");
  e.target.value=v;
};

/* ===== LOGIN / CADASTRO ===== */
async function entrar(){
  msg.textContent="";

  const email=emailInput=email.value.trim().toLowerCase();
  const senhaVal=senha.value;
  const cpfVal=cpf.value.replace(/\D/g,"");
  const celVal=celular.value.replace(/\D/g,"");

  if(!email||!senhaVal||!cpfVal||!celVal){
    msg.textContent="Preencha todos os campos.";
    return;
  }

  const {data:user}=await sb.from("usuarios").select("*").eq("email",email).single();

  /* LOGIN */
  if(user){
    if(user.senha!==senhaVal){
      msg.textContent="Senha incorreta.";
      return;
    }

    const agora=new Date();
    const exp=new Date(user.trial_expires_at);

    if(user.status==="pendente" && agora>exp){
      msg.textContent="Seu período de teste expirou.";
      return;
    }

    localStorage.usuario=JSON.stringify({id:user.id,email:user.email});
    location.href="index.html";
    return;
  }

  /* CADASTRO */
  const expira=new Date(Date.now()+12*60*60*1000);

  const {error}=await sb.from("usuarios").insert({
    email,
    senha:senhaVal,
    cpf:cpfVal,
    celular:celVal,
    status:"pendente",
    trial_expires_at:expira.toISOString()
  });

  if(error){
    msg.textContent="Erro ao criar conta.";
    return;
  }

  localStorage.usuario=JSON.stringify({email});
  location.href="index.html";
}
</script>

</body>
</html>
