<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SESS√ÉO 99</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SUPABASE CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<style>
body{
  margin:0;
  background:#05070f;
  color:#fff;
  font-family:Inter,Arial,sans-serif;
}
header{
  padding:16px 32px;
  background:#000;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
main{
  padding:32px;
}
#status{
  margin-bottom:20px;
  font-weight:600;
}
.ok{color:#22c55e}
.err{color:#ef4444}
.grid{
  display:flex;
  gap:16px;
  flex-wrap:wrap;
}
.card{
  width:200px;
  height:300px;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
}
.card img{
  width:100%;
  height:100%;
  object-fit:cover;
}
</style>
</head>
<body>

<header>
  <h2>üé¨ SESS√ÉO 99</h2>
  <input id="search" placeholder="Buscar...">
</header>

<main>
  <div id="status">‚è≥ Inicializando Supabase‚Ä¶</div>
  <div class="grid" id="grid"></div>
</main>

<script>
const statusEl = document.getElementById("status");
const grid = document.getElementById("grid");
const search = document.getElementById("search");

let supabaseClient = null;
let filmes = [];

/* ===============================
   ESPERAR SUPABASE EXISTIR
================================ */
function esperarSupabase(timeout = 5000){
  return new Promise((resolve, reject) => {
    const start = Date.now();
    const timer = setInterval(() => {
      if (window.supabase && window.supabase.createClient) {
        clearInterval(timer);
        resolve(window.supabase);
      }
      if (Date.now() - start > timeout) {
        clearInterval(timer);
        reject("Supabase n√£o carregou (timeout)");
      }
    }, 50);
  });
}

/* ===============================
   INIT
================================ */
async function init(){
  try{
    const supabaseLib = await esperarSupabase();

    statusEl.innerText = "üîå Conectando ao Supabase‚Ä¶";

    supabaseClient = supabaseLib.createClient(
      "https://dxkszikemntfusfyrzos.supabase.co",
      "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
    );

    carregarFilmes();

  }catch(err){
    statusEl.innerText = "‚ùå ERRO: " + err;
    statusEl.className = "err";
  }
}

/* ===============================
   CARREGAR FILMES
================================ */
async function carregarFilmes(){
  statusEl.innerText = "üì° Buscando filmes‚Ä¶";

  const { data, error } = await supabaseClient
    .from("filmes")
    .select("*")
    .eq("ativo", true);

  if(error){
    statusEl.innerText = "‚ùå ERRO SUPABASE: " + error.message;
    statusEl.className = "err";
    return;
  }

  statusEl.innerText = `‚úÖ ${data.length} filme(s) carregado(s)`;
  statusEl.className = "ok";

  filmes = data || [];
  render(filmes);
}

/* ===============================
   RENDER
================================ */
function render(lista){
  grid.innerHTML = "";
  lista.forEach(f => {
    if(!f.capa_url) return;
    const c = document.createElement("div");
    c.className = "card";
    c.innerHTML = `<img src="${f.capa_url}">`;
    c.onclick = () => window.open(f.video_url, "_blank");
    grid.appendChild(c);
  });
}

/* ===============================
   BUSCA
================================ */
search.oninput = () => {
  const v = search.value.toLowerCase();
  render(filmes.filter(f => f.titulo.toLowerCase().includes(v)));
};

init();
</script>

</body>
</html>
