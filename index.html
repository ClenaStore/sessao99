<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SESS√ÉO 99 ‚Ä¢ Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<style>
:root{
  --bg:#05070f;--panel:#0f1424;--card:#151a30;--input:#0b1020;
  --accent:#6366f1;--ok:#22c55e;--err:#ef4444;
  --text:#e5e7eb;--muted:#9ca3af;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,#05060c,#07090f);color:var(--text);font-family:Inter,Arial,sans-serif}

/* BOOT */
#boot{position:fixed;inset:0;background:#05070f;display:flex;align-items:center;justify-content:center;z-index:9999}
#bootBox{background:#0f1424;padding:26px 34px;border-radius:16px;text-align:center}
#bootStatus{color:var(--muted);font-weight:600}

/* LAYOUT */
.wrapper{max-width:1200px;margin:20px auto;padding:20px;display:none}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
header input{background:var(--input);border:none;border-radius:8px;padding:8px 12px;color:#fff}
.status{background:var(--input);padding:10px 14px;border-radius:8px;margin-bottom:10px;font-weight:600}
.ok{color:var(--ok)} .err{color:var(--err)} .muted{color:var(--muted)}

.grid{display:grid;grid-template-columns:340px 1fr;gap:16px;height:calc(100vh - 150px)}
.panel{background:var(--panel);border-radius:16px;padding:16px;display:flex;flex-direction:column}

/* FORM */
label{margin-top:10px;font-weight:600;font-size:13px}
input,textarea{width:100%;margin-top:4px;padding:10px;border-radius:8px;border:none;background:var(--input);color:#fff}
textarea{resize:none}
button{margin-top:14px;padding:12px;border:none;border-radius:10px;background:var(--accent);color:#fff;font-weight:600;cursor:pointer}

/* LISTA */
.list{flex:1;overflow-y:auto;display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
.item{background:var(--card);border-radius:12px;cursor:pointer;overflow:hidden}
.item img{width:100%;height:160px;object-fit:cover}
.item div{padding:8px}
.item h4{margin:0;font-size:13px}
.item span{font-size:11px;color:var(--muted)}

/* MODAL */
#modal{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:9998}
#modalBox{background:#0f1424;width:720px;max-width:95%;border-radius:16px;padding:18px;display:grid;grid-template-columns:260px 1fr;gap:16px}
#modalBox img{width:100%;height:360px;object-fit:cover;border-radius:12px}
#modalBox button{margin-right:6px}
</style>
</head>
<body>

<!-- BOOT -->
<div id="boot">
  <div id="bootBox">
    <h2>SESS√ÉO 99</h2>
    <div id="bootStatus">Conectando ao Supabase‚Ä¶</div>
  </div>
</div>

<div class="wrapper" id="app">

<header>
  <h2>Painel Admin</h2>
  <input id="search" placeholder="Buscar filme...">
</header>

<div id="status" class="status muted">Inicializando‚Ä¶</div>

<div class="grid">

<div class="panel">
  <h3>Novo Filme</h3>
  <label>T√≠tulo *</label><input id="titulo">
  <label>Descri√ß√£o</label><textarea id="descricao"></textarea>
  <label>Categoria</label><input id="categoria">
  <label>URL da capa</label><input id="capa">
  <label>Arquivo de v√≠deo *</label><input type="file" id="video" accept="video/*">
  <button onclick="enviar()">Enviar Filme</button>
</div>

<div class="panel">
  <h3>Filmes cadastrados</h3>
  <div id="lista" class="list"></div>
</div>

</div>
</div>

<!-- MODAL -->
<div id="modal">
  <div id="modalBox">
    <img id="mCapa">
    <div>
      <h3 id="mTitulo"></h3>
      <p id="mDesc" class="muted"></p>
      <p><b>Categoria:</b> <span id="mCat"></span></p>
      <button onclick="excluir()" style="background:#ef4444">Excluir</button>
      <button onclick="fechar()">Fechar</button>
    </div>
  </div>
</div>

<script>
const supabase=window.supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

const BUNNY={zone:"sessao99",region:"br",key:"d498d56e-361b-4a1e-9edb9eb63e3b-2e6a-4c17",cdn:"https://sessao99.b-cdn.net"};

const boot=document.getElementById("boot"),bootStatus=document.getElementById("bootStatus");
const app=document.getElementById("app"),statusEl=document.getElementById("status");
const lista=document.getElementById("lista"),search=document.getElementById("search");

let filmes=[],atual=null;

/* INIT */
(async()=>{
  try{
    const {data,error}=await supabase.from("filmes").select("*").order("created_at",{ascending:false});
    if(error) throw error.message;
    filmes=data||[];
    render(filmes);
    statusEl.textContent=`üü¢ ${filmes.length} filme(s) carregados`;
    statusEl.className="status ok";
    boot.style.display="none";app.style.display="block";
  }catch(e){
    bootStatus.textContent="ERRO: "+e;
    bootStatus.style.color="#ef4444";
  }
})();

/* RENDER */
function render(arr){
  lista.innerHTML="";
  arr.forEach(f=>{
    if(!f.capa_url) return;
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`<img src="${f.capa_url}"><div><h4>${f.titulo}</h4><span>${f.categoria||""}</span></div>`;
    d.onclick=()=>abrir(f);
    lista.appendChild(d);
  });
}

/* MODAL */
function abrir(f){
  atual=f;
  modal.style.display="flex";
  mCapa.src=f.capa_url;
  mTitulo.textContent=f.titulo;
  mDesc.textContent=f.descricao||"";
  mCat.textContent=f.categoria||"";
}
function fechar(){modal.style.display="none"}
async function excluir(){
  if(!confirm("Excluir este filme?")) return;
  await supabase.from("filmes").delete().eq("id",atual.id);
  location.reload();
}

/* BUSCA */
search.oninput=()=>{
  const v=search.value.toLowerCase();
  render(filmes.filter(f=>f.titulo.toLowerCase().includes(v)));
};

/* UPLOAD */
async function enviar(){
  if(!titulo.value||!video.files[0]) return alert("T√≠tulo e v√≠deo obrigat√≥rios");
  const file=video.files[0];
  const name=Date.now()+"_"+file.name.replace(/\s+/g,"_");
  await fetch(`https://${BUNNY.region}.storage.bunnycdn.com/${BUNNY.zone}/filmes/${name}`,{
    method:"PUT",headers:{AccessKey:BUNNY.key,"Content-Type":"application/octet-stream"},body:file
  });
  await supabase.from("filmes").insert({
    titulo:titulo.value,descricao:descricao.value,categoria:categoria.value,
    capa_url:capa.value,video_url:`${BUNNY.cdn}/filmes/${name}`,ativo:true
  });
  location.reload();
}
</script>
</body>
</html>
