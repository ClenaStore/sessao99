<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SESS√ÉO 99</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SUPABASE CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  background:#05070f;
  color:#fff;
  font-family:Inter,Arial,sans-serif;
}
header{
  padding:16px 32px;
  background:#000;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
main{
  padding:32px;
}
.row{
  display:flex;
  gap:16px;
  flex-wrap:wrap;
}
.card{
  width:200px;
  height:300px;
  border-radius:12px;
  overflow:hidden;
  cursor:pointer;
}
.card img{
  width:100%;
  height:100%;
  object-fit:cover;
}
#debug{
  margin-bottom:20px;
  color:#22c55e;
}
.error{
  color:#ef4444;
}
</style>
</head>
<body>

<header>
  <h2>üé¨ SESS√ÉO 99</h2>
  <input id="search" placeholder="Buscar...">
</header>

<main>
  <div id="debug">Inicializando Supabase‚Ä¶</div>
  <div class="row" id="grid"></div>
</main>

<script>
/* ===============================
   SUPABASE CLIENT (CORRETO)
================================ */
const supabase = window.supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

const debug = document.getElementById("debug");
const grid = document.getElementById("grid");
const search = document.getElementById("search");

let filmes = [];

/* ===============================
   LOAD
================================ */
async function carregar(){
  debug.innerText = "Buscando filmes no Supabase‚Ä¶";

  const { data, error } = await supabase
    .from("filmes")
    .select("*")
    .eq("ativo", true);

  if(error){
    debug.innerHTML = "‚ùå ERRO:<br>" + JSON.stringify(error, null, 2);
    debug.className = "error";
    return;
  }

  debug.innerText = `‚úÖ ${data.length} filme(s) carregado(s)`;
  filmes = data || [];
  render(filmes);
}

/* ===============================
   RENDER
================================ */
function render(lista){
  grid.innerHTML = "";
  lista.forEach(f => {
    if(!f.capa_url) return;

    const c = document.createElement("div");
    c.className = "card";
    c.innerHTML = `<img src="${f.capa_url}">`;
    c.onclick = () => window.open(f.video_url, "_blank");
    grid.appendChild(c);
  });
}

/* ===============================
   SEARCH
================================ */
search.oninput = () => {
  const v = search.value.toLowerCase();
  render(filmes.filter(f => f.titulo.toLowerCase().includes(v)));
};

carregar();
</script>

</body>
</html>
