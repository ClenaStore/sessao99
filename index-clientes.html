<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>SESS√ÉO 99</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

<style>
:root{
  --bg:#040714;
  --card:#141a2e;
  --accent:#e50914;
  --text:#fff;
  --radius:16px;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:#000;
  color:var(--text);
  font-family:Inter,Arial,sans-serif;
}

/* ================= HEADER ================= */
header{
  position:sticky;
  top:0;
  z-index:100;
  padding:18px 32px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(12px);
}
.logo{
  font-size:26px;
  font-weight:800;
}
.logo span{color:var(--accent)}
header input{
  width:320px;
  max-width:50vw;
  padding:12px 18px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,.15);
  background:#111;
  color:#fff;
}

/* ================= HOME ================= */
main{padding:30px 0 90px}
section{margin-bottom:46px}
section h2{
  margin:0 0 14px 32px;
  font-size:22px;
}

/* ================= ROW ================= */
.row{
  display:flex;
  gap:18px;
  padding:0 32px;
  overflow-x:auto;
}
.row::-webkit-scrollbar{display:none}

/* ================= CARD ================= */
.card{
  min-width:220px;
  max-width:220px;
  border-radius:var(--radius);
  overflow:hidden;
  cursor:pointer;
  transition:.35s;
  position:relative;
}
.card img{
  width:100%;
  height:320px;
  object-fit:cover;
}
.card:hover{transform:scale(1.08)}
.card span{
  position:absolute;
  bottom:12px;
  left:12px;
  right:12px;
  font-weight:600;
  z-index:2;
}
.card::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(to top,rgba(0,0,0,.8),transparent 55%);
}

/* ================= PLAYER ================= */
#player{
  position:fixed;
  inset:0;
  background:#000;
  display:none;
  flex-direction:column;
  z-index:9999;
}

/* HERO */
.hero{
  position:relative;
  height:55vh;
  min-height:320px;
}
.hero img{
  width:100%;
  height:100%;
  object-fit:cover;
}
.hero::after{
  content:"";
  position:absolute;
  inset:0;
  background:linear-gradient(to top,#000 10%,rgba(0,0,0,.4),transparent);
}
.hero-content{
  position:absolute;
  bottom:26px;
  left:26px;
  z-index:2;
}
.hero-content h1{
  margin:0;
  font-size:32px;
}
.back-btn{
  position:absolute;
  top:20px;
  left:20px;
  z-index:3;
  background:rgba(0,0,0,.6);
  border:none;
  color:#fff;
  font-size:18px;
  padding:10px 14px;
  border-radius:999px;
  cursor:pointer;
}

/* SELECTS (APENAS S√âRIE) */
.selects{
  display:none;
  gap:14px;
  padding:18px 26px;
}
.selects select{
  background:#111;
  border:1px solid rgba(255,255,255,.15);
  border-radius:10px;
  padding:10px 14px;
  color:#fff;
}

/* VIDEO */
video{
  width:100%;
  height:calc(100vh - 55vh);
  background:#000;
}

/* MOBILE */
@media(max-width:768px){
  .hero-content h1{font-size:22px}
  header{padding:14px 18px}
  .row{padding:0 18px}
  .card{min-width:160px}
  .card img{height:240px}
}
</style>
</head>

<body>

<header>
  <div class="logo">SESS√ÉO <span>99</span></div>
  <input id="search" placeholder="Buscar filmes ou s√©ries">
</header>

<main id="home"></main>

<div id="player">
  <div class="hero">
    <button class="back-btn" onclick="fechar()">‚¨Ö</button>
    <img id="capaPlayer">
    <div class="hero-content">
      <h1 id="tituloPlayer"></h1>
    </div>
  </div>

  <div class="selects" id="selects">
    <select id="selTemporada"></select>
    <select id="selEpisodio"></select>
  </div>

  <video id="video" controls></video>
</div>

<script>
/* ================= SUPABASE ================= */
const supabaseClient = supabase.createClient(
  "https://dxkszikemntfusfyrzos.supabase.co",
  "sb_publishable_NNFvdfSXgOdGGVcSbphbjQ_brC3_9ed"
);

/* ================= ELEMENTOS ================= */
const home=document.getElementById("home");
const search=document.getElementById("search");
const player=document.getElementById("player");
const tituloPlayer=document.getElementById("tituloPlayer");
const capaPlayer=document.getElementById("capaPlayer");
const selTemporada=document.getElementById("selTemporada");
const selEpisodio=document.getElementById("selEpisodio");
const selects=document.getElementById("selects");
const video=document.getElementById("video");

/* ================= STATE ================= */
let dados=[],serieAtual=[],episodioAtual=null;

/* ================= LOAD ================= */
async function load(){
  const {data}=await supabaseClient.from("filmes").select("*").eq("ativo",true);
  dados=data||[];
  renderHome(dados);
}

/* ================= HOME ================= */
function renderHome(list){
  home.innerHTML="";
  const filmes=list.filter(i=>i.tipo==="filme");
  const series=[...new Map(list.filter(i=>i.tipo==="serie").map(s=>[s.serie_nome,s])).values()];
  renderRow("üé¨ Filmes",filmes,playFilme);
  renderRow("üì∫ S√©ries",series,s=>abrirSerie(s.serie_nome));
}

function renderRow(titulo,itens,click){
  if(!itens.length)return;
  const sec=document.createElement("section");
  sec.innerHTML=`<h2>${titulo}</h2>`;
  const row=document.createElement("div");
  row.className="row";
  itens.forEach(i=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<img src="${i.capa_url}"><span>${i.titulo||i.serie_nome}</span>`;
    c.onclick=()=>click(i);
    row.appendChild(c);
  });
  sec.appendChild(row);
  home.appendChild(sec);
}

/* ================= PLAYER ================= */
function playFilme(f){
  selects.style.display="none";
  abrirPlayer(f.titulo,f.capa_url);
  tocar(f);
}

function abrirSerie(nome){
  serieAtual=dados.filter(d=>d.serie_nome===nome)
    .sort((a,b)=>a.temporada-b.temporada||a.episodio-b.episodio);
  selects.style.display="flex";
  abrirPlayer(nome,serieAtual[0].capa_url);
  montarTemporadas();
}

function abrirPlayer(titulo,capa){
  tituloPlayer.textContent=titulo;
  capaPlayer.src=capa;
  player.style.display="flex";
}

function montarTemporadas(){
  const temps=[...new Set(serieAtual.map(e=>e.temporada))];
  selTemporada.innerHTML="";
  temps.forEach(t=>selTemporada.innerHTML+=`<option value="${t}">Temporada ${t}</option>`);
  selTemporada.onchange=montarEpisodios;
  montarEpisodios();
}

function montarEpisodios(){
  const t=Number(selTemporada.value);
  const eps=serieAtual.filter(e=>e.temporada===t);
  selEpisodio.innerHTML="";
  eps.forEach((e,i)=>selEpisodio.innerHTML+=`<option value="${i}">Epis√≥dio ${e.episodio}</option>`);
  selEpisodio.onchange=()=>tocar(eps[selEpisodio.value]);
  tocar(eps[0]);
}

function tocar(ep){
  episodioAtual=ep;
  video.src=ep.video_url;
  video.load();
}

video.addEventListener("loadedmetadata",()=>video.play());

function fechar(){
  video.pause();
  video.src="";
  player.style.display="none";
}

search.oninput=()=>{
  const v=search.value.toLowerCase();
  renderHome(dados.filter(d =>
    d.titulo?.toLowerCase().includes(v) ||
    d.serie_nome?.toLowerCase().includes(v)
  ));
};

load();
</script>

</body>
</html>
